(()=>{"use strict";const e=class{btn;constructor(e){this.btn=document.createElement("button"),this.btn.classList.add(e)}createButton(e=""){return this.btn.classList.add("button"),this.btn.type="button",this.btn.append(e),this.btn}},t=class{cars;car;winner;winners;isCreated;isWinnerCreated;isDeleted;isWinnerDeleted;isUpdated;isWinnerUpdated;isStarted;isStopped;aborted;constructor(){this.cars=[],this.car={name:"",color:"#ffffff",id:0},this.winners=[],this.winner={id:-1,wins:0,time:-1},this.isCreated=!1,this.isWinnerCreated=!1,this.isDeleted=!1,this.isWinnerDeleted=!1,this.isUpdated=!1,this.isWinnerUpdated=!1,this.isStarted=!1,this.isStopped=!1,this.aborted=[]}async getCars(e,t){const n=await fetch(`http://127.0.0.1:3000/garage?_page=${e}&_limit=${t}`,{method:"GET",cache:"no-store"}),a=n.headers.get("X-Total-Count");if(!a)throw new Error("Bad header");if(200!==n.status)throw new Error("Response was not OK");return this.cars=await n.json(),{total:a,cars:this.cars}}async getCar(e){const t=await fetch(`http://127.0.0.1:3000/garage/${e}`,{method:"GET",cache:"no-store"});if(200!==t.status)throw new Error("Response was not OK");return this.car=await t.json(),this.car}async createCar(e){if(this.isCreated=!1,201!==(await fetch("http://127.0.0.1:3000/garage",{method:"POST",cache:"no-store",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e.name,color:e.color})})).status)throw new Error("Response was not OK");return this.isCreated=!0,this.isCreated}async deleteCar(e){if(this.isDeleted=!1,200!==(await fetch(`http://127.0.0.1:3000/garage/${e}`,{method:"DELETE",cache:"no-store"})).status)throw new Error("Response was not OK");return this.isDeleted=!0,this.isDeleted}async updateCar(e){if(this.isUpdated=!1,200!==(await fetch(`http://127.0.0.1:3000/garage/${e.id}`,{method:"PUT",cache:"no-store",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e.name,color:e.color})})).status)throw new Error("Response was not OK");return this.isUpdated=!0,this.isUpdated}async startEngine(e){this.isStarted=!1;const t=await fetch(`http://127.0.0.1:3000/engine?id=${e}&status=started`,{method:"PATCH",cache:"no-store"});if(200!==t.status)throw new Error("Response was not OK");const n=await t.json();return Math.floor(n.distance/n.velocity)}async stopEngine(e){if(this.isStopped=!1,200!==(await fetch(`http://127.0.0.1:3000/engine?id=${e}&status=stopped`,{method:"PATCH",cache:"no-store"})).status)throw new Error("Response was not OK");return this.isStopped=!0,this.isStopped}async driveCar(e){const t=new AbortController;this.aborted.push({controller:t,carId:Number(e)});const n=await fetch(`http://127.0.0.1:3000/engine?id=${e}&status=drive`,{method:"PATCH",cache:"no-store",signal:t.signal});if(500===n.status||404===n.status)return!1;if(200!==n.status)throw new Error("Response was not OK");return!0}async getWinners(e,t,n,a){const s=await fetch(`http://127.0.0.1:3000/winners?_page=${e}&_limit=${t}&_sort=${n}&_order=${a}`,{method:"GET",cache:"no-store"}),r=s.headers.get("X-Total-Count");if(!r)throw new Error("Bad header");if(200!==s.status)throw new Error("Response was not OK");return this.winners=await s.json(),{total:r,winners:this.winners}}async getWinner(e){this.winner={id:-1,wins:0,time:-1};const t=await fetch(`http://127.0.0.1:3000/winners/${e}`,{method:"GET",cache:"no-store"});if(404===t.status)return this.winner;if(200!==t.status)throw new Error("Response was not OK");return this.winner=await t.json(),this.winner}async createWinner(e){if(this.isWinnerCreated=!1,201!==(await fetch("http://127.0.0.1:3000/winners",{method:"POST",cache:"no-store",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).status)throw new Error("Response was not OK");return this.isWinnerCreated=!0,this.isWinnerCreated}async updateWinner(e){if(this.isWinnerUpdated=!1,200!==(await fetch(`http://127.0.0.1:3000/winners/${e.id}`,{method:"PUT",cache:"no-store",headers:{"Content-Type":"application/json"},body:JSON.stringify({wins:e.wins,time:e.time})})).status)throw new Error("Response was not OK");return this.isWinnerUpdated=!0,this.isWinnerUpdated}async deleteWinner(e){if(this.isWinnerDeleted=!1,200!==(await fetch(`http://127.0.0.1:3000/winners/${e}`,{method:"DELETE",cache:"no-store"})).status)throw new Error("Response was not OK");return this.isWinnerDeleted=!0,this.isWinnerDeleted}},n=class{randomNumber;hexValue;carFirstNames;carSecondNames;constructor(){this.randomNumber=0,this.hexValue="",this.carFirstNames=["Lada","Opel","BMW","Audi","Mersedes","Scoda","Ford","Chrysler","Tesla","Volkswagen"],this.carSecondNames=["Granta","Vesta","X5","X3","TT","Focus","Mustang","Yeti","Q7","Polo"]}getRandomInteger(e,t){return this.randomNumber=Math.trunc(Math.random()*(t-e+1))+e,this.randomNumber}getRandomName(){return`${this.carFirstNames[this.getRandomInteger(0,9)]} ${this.carSecondNames[this.getRandomInteger(0,9)]}`}getRandomColor(){return this.RGBtoHex(this.getRandomInteger(0,255),this.getRandomInteger(0,255),this.getRandomInteger(0,255))}RGBtoHex(e,t,n){const a=e<16?`0${e.toString(16)}`:e.toString(16),s=t<16?`0${t.toString(16)}`:t.toString(16),r=n<16?`0${n.toString(16)}`:n.toString(16);return this.hexValue=`#${a}${s}${r}`,this.hexValue}};class a{garageScreen;header;main;nav;controlPanel;garage;garagePage;winnerMgs;winner;carsArr;asyncApi;util;selectedCar;currentPage;constructor(){this.garageScreen=document.createElement("div"),this.header=document.createElement("header"),this.main=document.createElement("main"),this.nav=document.createElement("nav"),this.controlPanel=document.createElement("div"),this.garage=document.createElement("div"),this.garagePage=document.createElement("div"),this.winnerMgs=document.createElement("p"),this.carsArr=[],this.asyncApi=new t,this.selectedCar=0,this.util=new n,this.winner={id:-1,wins:0,time:-1},this.currentPage=1}create(){this.garageScreen.classList.add("garage-screen"),this.header.classList.add("header"),this.main.classList.add("main"),this.nav.classList.add("nav"),this.controlPanel.classList.add("control-panel"),this.garage.classList.add("garage"),this.garage.addEventListener("click",this.whichButton.bind(this)),this.winnerMgs.classList.add("winner-msg");const t=new e("nav__garage").createButton("To Garage"),n=new e("nav__winners").createButton("To Winners");return t.addEventListener("click",(()=>a.toGarage())),n.addEventListener("click",(()=>a.toWinners())),this.feedControlPanel(),this.feedGarage(),this.nav.append(t,n),this.header.append(this.nav),this.main.append(this.controlPanel,this.garage),this.garageScreen.append(this.header,this.main,this.winnerMgs),this.garageScreen}feedControlPanel(){const t=document.createElement("div");t.classList.add("control-panel-create");const n=document.createElement("input");n.classList.add("control-panel-create__name"),n.type="text";const a=document.createElement("input");a.classList.add("control-panel-create__color"),a.type="color",a.value="#ffffff";const s=new e("control-panel-create__crt").createButton("Create");s.addEventListener("click",(()=>this.createCar(n,a)));const r=document.createElement("div");r.classList.add("control-panel-update");const i=document.createElement("input");i.classList.add("control-panel-update__name"),i.type="text";const c=document.createElement("input");c.classList.add("control-panel-update__color"),c.type="color",c.value="#ffffff";const o=new e("control-panel-update__upt").createButton("Update");o.addEventListener("click",(()=>this.updateCar(i,c,o))),i.classList.add("control-panel-update__name_disabled"),c.classList.add("control-panel-update__color_disabled"),o.classList.add("control-panel-update__upt_disabled");const l=document.createElement("div");l.classList.add("control-panel-functional");const d=new e("control-panel-functional__race").createButton("Race"),h=new e("control-panel-functional__reset").createButton("Reset"),u=new e("control-panel-functional__generate").createButton("Generate Cars");h.classList.add("control-panel-functional__reset_disabled"),d.addEventListener("click",this.race.bind(this)),h.addEventListener("click",this.reset.bind(this)),u.addEventListener("click",this.generateCars.bind(this)),t.append(n,a,s),r.append(i,c,o),l.append(d,h,u),this.controlPanel.append(t,r,l)}feedGarage(){const t=document.createElement("h2");t.classList.add("garage__title"),this.garagePage.classList.add("garage-page");const n=document.createElement("h3");n.classList.add("garage-page__title");const a=document.createElement("div");a.classList.add("garage-page__cars");const s=document.createElement("div");s.classList.add("garage-controls");const r=new e("garage-controls__prev").createButton("<-"),i=new e("garage-controls__next").createButton("->");r.addEventListener("click",(()=>this.movePage(!1))),i.addEventListener("click",(()=>this.movePage(!0))),s.append(r,i),this.garagePage.append(n,a),this.garage.append(t,s,this.garagePage),this.updateGaragePage()}async movePage(e){if(this.currentPage=e?this.currentPage+1:this.currentPage-1,this.currentPage<1)return void(this.currentPage=1);const{cars:t}=await this.asyncApi.getCars(this.currentPage,7);0===t.length?this.currentPage=e?this.currentPage-1:this.currentPage+1:this.updateGaragePage()}static addCar(t,n){const s=document.createElement("div");s.classList.add("car"),s.id=String(t.id);const r=document.createElement("div");r.classList.add("car-controls");const i=new e("car-controls__select").createButton("Select"),c=new e("car-controls__remove").createButton("Remove"),o=document.createElement("p");o.classList.add("car-controls__name"),o.append(t.name);const l=document.createElement("div");l.classList.add("track");const d=new e("track__start").createButton("S"),h=new e("track__restart").createButton("R");h.classList.add("track__restart_disabled");const u=document.createElement("div");u.classList.add("track__finish"),l.append(d,h,a.setCarImg(t.color),u),r.append(i,c,o),s.append(r,l),n.append(s)}static setCarImg(e){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");return t.classList.add("track__car-img"),t.setAttributeNS(null,"viewBox","0 0 1280 640"),t.setAttributeNS(null,"width","1706.667"),t.setAttributeNS(null,"height","853.333"),t.setAttributeNS(null,"fill",e),["M356.5 106.4c-10.6 3-10.1 2.6-10.8 11.1-.4 4.2-.9 8-1.2 8.5-.6 1-24.6 10.5-59 23.4-44.8 16.7-105.2 41.5-117.3 48.3-7.8 4.3-19.3 9.1-25 10.4-2.3.5-9.8 1.4-16.5 1.9-6.7.6-16.7 1.9-22.2 3-15.4 3.1-34 4.9-56.3 5.7l-20.3.6-4.3 6.6c-5.9 9.1-6 9.5-2.6 13 3.7 3.7 3.8 6.5.3 15-2.5 6.2-2.7 7.8-3.1 25.6l-.4 19-3.8 3.2C4.9 309.5.7 322.6.6 343.5c0 19.4 1.1 39.6 2.6 48.2 1.3 7.1 1.4 7.4 7.2 12.2 6.9 5.8 13 12.9 15.8 18.4 6.4 12.6 53.4 21.1 138.4 25l9.2.4-.6-11.9c-.6-14.2.8-25.6 4.9-38.3 11.2-35.2 39.4-62.2 75.6-72.2 9-2.6 11.2-2.8 27.8-2.8 16.5 0 18.8.2 27.8 2.7 20.1 5.6 36.1 15.2 50.4 30.2 14 14.5 22.2 29.3 27.4 49.2 2.1 7.9 2.4 10.9 2.3 27.9-.1 12.7-.6 21.4-1.6 26.3l-1.5 7.3 300.6-.7c165.3-.4 300.7-.8 300.9-.9.1-.1-.8-3.7-2-8.1-1.9-6.7-2.2-10.5-2.2-25.9-.1-16.6.1-18.7 2.7-27.9 11.7-42.1 46.7-73.6 88.5-79.7 11.9-1.7 32.5-.7 43.2 2.1 23.9 6.3 45.3 20.5 60.1 39.9 7 9.2 15.4 26.7 18.5 38.6 2.4 8.8 2.7 11.9 2.7 26 .1 11.6-.4 18.1-1.6 23.4-1 4.1-1.6 7.5-1.5 7.6.2.1 6.2-.2 13.3-.6 26.6-1.6 45.8-4.5 52.5-7.9 4.8-2.4 9.7-8.1 12.7-14.6l2.4-5.2-1.6-15.7c-1.5-15.2-1.5-16.3.4-28.4 6.3-38.8 5-68-3.5-80.2-13.4-19.3-52.6-33.6-142.9-51.9-73.7-14.9-132.2-20.9-203.3-21-22.8 0-22.6 0-34.7-8.5-18.7-13.1-104.5-60.7-147.1-81.5-38.3-18.7-78.8-28.1-143.9-33.2-20.8-1.7-110.6-1.6-140 0-12.1.7-31.4 1.9-43 2.7-30.2 2.2-28.6 2.2-34.1-1-14-8.1-18.7-9.4-26.9-7.1zM545 139.7c.6 3.7 3.8 23.8 7.1 44.6 3.2 20.9 6.6 42.2 7.5 47.4.9 5.2 1.5 9.6 1.3 9.7-1.1.9-169.9-2.9-195.1-4.4-20.6-1.3-41.7-3.6-48.5-5.4-9.8-2.6-19.8-11.9-24.9-23.1-3.5-7.5-3.6-17.2-.5-25.5 1.7-4.5 3-6.1 6.8-8.6 8.3-5.4 13.5-8 25.3-12.7 34.1-13.6 85.8-23 146-26.7 26.9-1.6 27-1.6 51.1-1.8l22.7-.2 1.2 6.7zm63-4.7c26.4 1.8 77.7 11 102.9 18.6 18.6 5.6 44.5 18.8 75.6 38.7 21.1 13.4 27.4 18.1 25 18.5-7.5 1.2-13.3 5-16.2 10.6-1.9 3.5-2.1 13.6-.4 17.9l1.1 2.7-90.7-.2-90.6-.3-5.9-16c-11-30.2-29.8-87.8-29.8-91.6 0-.6 9.5-.2 29 1.1z","M263.3 327.5c-22.3 4-41 14.1-56.8 30.6-13.2 13.8-21.3 28.3-26.2 46.7-2.2 8.3-2.6 11.9-2.6 24.7-.1 16.9 1 23.6 6.5 38.2 8.7 23 27.1 43.6 49.3 55.1 8.5 4.4 17.8 7.8 27.1 9.8 10.7 2.3 31.2 2.3 41.9-.1 39.2-8.4 69.9-37.5 80.2-76.1 2.3-8.6 2.6-12 2.7-25.4.1-15.8-.5-19.9-4.6-33-9.8-31-35.5-56.7-66.8-66.9-15-5-35.4-6.4-50.7-3.6zm35 30.1c24.9 5.6 45.7 24.7 54.3 49.9 2.5 7.2 2.8 9.5 2.8 22 .1 15.3-1.5 22.8-7.4 34.5-9.4 18.6-28.3 33.7-48.5 38.6-9.6 2.4-26.8 2.4-36 0-32-8.4-54.4-35.5-56.2-68.1-2-35.9 20.9-67.3 55.8-76.5 9.4-2.4 25.3-2.6 35.2-.4z","M260 370.3c-3.6 1.3-8.5 3.6-10.9 5.1l-4.4 2.8 11.6 11.5c8.1 8.2 12 11.4 13.1 11 1.4-.6 1.6-2.9 1.6-16.7 0-18.6.6-17.8-11-13.7zM292 383.9c0 13.9.2 16.2 1.6 16.8 1.1.4 5-2.8 13-10.8l11.5-11.4-2.8-2.2c-3.4-2.8-13.8-7-19.3-7.9l-4-.7v16.2zM228.2 395.2c-2.8 3.6-9.2 19.1-9.2 22.5 0 1 3.4 1.3 16.5 1.3 15.1 0 16.5-.1 16.5-1.8 0-1.5-20.6-23.2-22.1-23.2-.4 0-1.1.6-1.7 1.2zM322.2 404.9c-6.2 5.9-11.2 11.5-11.2 12.4 0 1.5 1.7 1.7 16.5 1.7 13.1 0 16.5-.3 16.5-1.3 0-4-6.9-20.5-9.5-22.7-.7-.6-4.8 2.7-12.3 9.9zM278.1 406.8c-1.2 2.2 1.1 6.2 3.4 6.2.8 0 2.1-1 2.9-2.2 2-2.8.4-5.8-2.9-5.8-1.3 0-2.9.8-3.4 1.8zM274.9 423.9c-3.2 3.3-3.7 6.7-1.4 11 2.9 5.7 10.4 6.4 15.1 1.4 5.3-5.7.9-15.3-7.1-15.3-2.7 0-4.4.8-6.6 2.9zM257 427.5c-2.6 3.2 1.3 8.1 4.8 5.9 2.4-1.6 2.7-4.5.6-6.1-2.3-1.7-3.9-1.6-5.4.2zM300.6 427.6c-2 1.9-2 3.8-.2 5.4 2.3 1.9 6.1.8 6.4-1.8.7-4.4-3.2-6.7-6.2-3.6zM219 442.5c0 2.9 4.1 14 7.2 19.4l3.1 5.3 11.7-11.7c7.1-7.1 11.6-12.3 11.3-13.1-.4-1.1-4-1.4-16.9-1.4-14.1 0-16.4.2-16.4 1.5zM311 442.8c0 .9 5.1 6.8 11.4 13.1l11.4 11.4 3.1-5.4c3-5.1 7.1-16.5 7.1-19.5 0-1.1-3.1-1.4-16.5-1.4-15.1 0-16.5.1-16.5 1.8zM278 449.9c-.7 1.5-.5 2.4.8 4.1 3.2 4 8.5.4 6.2-4.1-1.4-2.5-5.6-2.5-7 0zM256.2 470.3c-6.1 6.2-11.2 11.5-11.2 11.9 0 1.8 20.8 10.8 24.9 10.8.7 0 1.1-5.4 1.1-16.4 0-14-.2-16.5-1.6-17-.9-.3-1.6-.6-1.7-.6-.1 0-5.3 5.1-11.5 11.3zM293.3 459.7c-1.5.6-1.9 33.3-.4 33.3 4.6 0 25.1-8.8 25.1-10.8 0-.9-22.3-23.2-23-23.1-.3 0-1.1.3-1.7.6zM1070 328.1c-39 8.4-69.6 37.6-79.7 75.9-3.1 11.7-4.1 29.2-2.4 41.1 3.3 22.7 15 45.3 31.8 60.9 26.7 25 64.3 34.4 99.3 24.9 11.7-3.2 28.3-11.8 38-19.6 48.7-39.6 51.8-112.8 6.7-156-9.7-9.3-16.6-14-29-19.8-13.7-6.4-23.5-8.6-40.7-9.1-12-.3-16.2 0-24 1.7zm44.5 31.3c23.8 8.1 40.9 25.8 48.6 50.6 3 9.6 3.3 28.9.5 38.8-11 40-51.3 63.7-91.1 53.6-14.9-3.8-31.3-14.7-40.2-26.7-17.6-23.8-20.3-53.3-7.1-79.7 3.4-6.9 6-10.3 13.8-18 7.7-7.8 11.1-10.4 18.1-13.9 12.9-6.5 20.7-8.1 36.4-7.7 10.9.3 14.3.7 21 3z","M1070.3 370c-5.4 1.9-15.3 7.1-15.3 8 0 .3 5.1 5.7 11.4 11.9 8 8 11.9 11.2 13 10.8 1.4-.5 1.6-2.9 1.6-16.7v-16l-2.7.1c-1.6 0-5.2.9-8 1.9zM1102 383.9c0 13.9.2 16.2 1.6 16.8 2.2.8 24.7-21.6 23.4-23.2-1.7-2-16.3-8.4-20.7-9.1l-4.3-.7v16.2zM1036.6 397.6c-2.9 4.4-7.6 16.5-7.6 19.4 0 1.9.7 2 16.5 2 12.6 0 16.5-.3 16.5-1.3 0-.7-5.1-6.3-11.4-12.6l-11.4-11.4-2.6 3.9zM1131.3 405.2c-6.1 6.2-10.9 11.9-10.6 12.5.6 1.5 33.3 1.9 33.3.4 0-4.5-8.8-24.1-10.8-24.1-.4 0-5.7 5.1-11.9 11.2zM1088.2 406.2c-1.7 1.7-1.5 3.2.7 5.2 1.6 1.4 2.3 1.5 4.1.6 3.1-1.7 2.4-6.4-1-6.8-1.4-.2-3.1.3-3.8 1zM1084.6 424.1c-6.8 8.1 1.7 19.4 11 14.4 8.9-4.8 5.6-17.5-4.6-17.5-3 0-4.4.6-6.4 3.1zM1067 427.4c-1.9 2.3-.8 6.1 1.8 6.4 4.4.7 6.7-3.2 3.6-6.2-1.9-2-3.8-2-5.4-.2zM1110.6 427.3c-2.1 1.6-1.8 4.5.7 6.1 3.7 2.3 7.7-3.5 4.1-6.1-1-.7-2.1-1.3-2.4-1.3-.3 0-1.4.6-2.4 1.3zM1029 443c0 2.9 4.3 14.1 7.4 19.5l2.8 4.8 11.6-11.6c8.1-8.1 11.3-12 10.9-13.1-.6-1.4-2.9-1.6-16.7-1.6-15.2 0-16 .1-16 2zM1120.7 442.2c-.3.7 4.7 6.6 11.1 13l11.6 11.8 2.7-4.3c2.7-4.4 7.9-17.7 7.9-20.3 0-1.2-2.8-1.4-16.4-1.4-12.2 0-16.6.3-16.9 1.2zM1088.1 449.9c-1.4 2.5-.5 4.8 2 5.6 2.7.9 5.1-1.3 4.7-4.4-.4-3.4-5.1-4.3-6.7-1.2zM1066.2 470.3c-6.1 6.2-11.2 11.5-11.2 11.9 0 2 20.1 10.8 24.7 10.8 1 0 1.3-3.4 1.3-16.4 0-14-.2-16.5-1.6-17-.9-.3-1.6-.6-1.7-.6-.1 0-5.3 5.1-11.5 11.3zM1103.3 459.7c-1 .3-1.3 4.7-1.3 16.9 0 9 .4 16.4.8 16.4 3.6 0 18.6-6.1 23.9-9.8 1.6-1-21.6-24.2-23.4-23.5z"].forEach((e=>{const n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttributeNS(null,"d",e),t.append(n)})),t}async createCar(e,t){if(await this.asyncApi.createCar({name:e.value,color:t.value,id:0})){const n=t;e.value="",n.value="#ffffff",this.updateGaragePage()}}async generateCars(){this.carsArr=Array.from({length:100},(()=>({name:this.util.getRandomName(),color:this.util.getRandomColor(),id:0})));let e=0;this.carsArr.forEach((async t=>{await this.asyncApi.createCar(t),e+=1,e===this.carsArr.length&&this.updateGaragePage()}))}async updateCar(e,t,n){if(await this.asyncApi.updateCar({name:e.value,color:t.value,id:this.selectedCar})){document.body.dispatchEvent(new Event("updateWinner"));const a=t;e.value="",a.value="#ffffff",this.selectedCar=0,e.classList.add("control-panel-update__name_disabled"),t.classList.add("control-panel-update__color_disabled"),n.classList.add("control-panel-update__upt_disabled"),this.updateGaragePage()}}async whichButton(e){const{target:t}=e;if(t instanceof HTMLButtonElement)try{switch(t.textContent){case"Remove":await this.removeCar(t);break;case"Select":await this.selectCar(t);break;case"S":await this.driveCar(t,!1);break;case"R":await this.resetCar(t)}}catch(e){e instanceof Error&&"Engine was broken"===e.message||console.error(e)}}async removeCar(e){const t=e.parentElement;if(!t)return;const n=t.parentElement;if(n&&await this.asyncApi.deleteCar(n.id)&&(this.winner.id=Number(n.id),document.body.dispatchEvent(new Event("deleteWinner")),this.updateGaragePage(),Number(n.id)===this.selectedCar)){this.selectedCar=0;const e=this.controlPanel.querySelector(".control-panel-update__name"),t=this.controlPanel.querySelector(".control-panel-update__color"),n=this.controlPanel.querySelector(".control-panel-update__upt");e instanceof HTMLInputElement&&t instanceof HTMLInputElement&&n instanceof HTMLButtonElement&&(e.classList.add("control-panel-update__name_disabled"),t.classList.add("control-panel-update__color_disabled"),n.classList.add("control-panel-update__upt_disabled"),e.value="",t.value="#ffffff")}}async selectCar(e){const t=e.parentElement;if(!t)return;const n=t.parentElement;if(!n)return;this.selectedCar=Number(n.id);const a=await this.asyncApi.getCar(n.id),s=this.controlPanel.querySelector(".control-panel-update__name"),r=this.controlPanel.querySelector(".control-panel-update__color"),i=this.controlPanel.querySelector(".control-panel-update__upt");s instanceof HTMLInputElement&&r instanceof HTMLInputElement&&i instanceof HTMLButtonElement&&(s.classList.remove("control-panel-update__name_disabled"),r.classList.remove("control-panel-update__color_disabled"),i.classList.remove("control-panel-update__upt_disabled"),s.value=a.name,r.value=a.color)}areAllStartButtonsOn(){return!this.garagePage.querySelector(".track__start_disabled")}areAllRestartButtonsOn(){return!this.garagePage.querySelector(".track__restart_disabled")}areAllRestartButtonsOff(){const e=Array.from(this.garagePage.querySelectorAll(".track__restart"));return e.length===e.filter((e=>e.classList.contains("track__restart_disabled"))).length}paginationButtonsStateChanger(e){const t=this.garage.querySelector(".garage-controls__prev"),n=this.garage.querySelector(".garage-controls__next");t&&n&&(e?(t.classList.remove("garage-controls__prev_disabled"),n.classList.remove("garage-controls__next_disabled")):(t.classList.add("garage-controls__prev_disabled"),n.classList.add("garage-controls__next_disabled")))}async driveCar(e,t){this.paginationButtonsStateChanger(!1);const n={animation:-1,id:-1},a=e.parentElement;if(!a)return n;e.classList.add("track__start_disabled");const s=document.querySelector(".control-panel-functional__race");s&&s.classList.add("control-panel-functional__race_disabled");const r=a.parentElement;if(!r)return n;const i=this.garagePage.querySelectorAll(".car-controls__select"),c=this.garagePage.querySelectorAll(".car-controls__remove");i.forEach((e=>{e.classList.add("car-controls__select_disabled")})),c.forEach((e=>{e.classList.add("car-controls__remove_disabled")})),this.blockButtons();const o=await this.asyncApi.startEngine(r.id);document.documentElement.style.setProperty("--track-width",`${a.clientWidth}px`);const l=a.querySelector(".track__car-img");if(!(l instanceof SVGSVGElement))return n;if(l.style.animationDuration=`${o}ms`,l.classList.add("car-drive"),l.classList.add("car-finished"),!t){const e=a.querySelector(".track__restart");e&&e.classList.remove("track__restart_disabled")}try{const e=await this.asyncApi.driveCar(r.id);if(this.asyncApi.aborted=this.asyncApi.aborted.filter((e=>e.carId!==Number(r.id))),!e)throw l.classList.add("stop-car"),l.classList.add("track__car-img_fire"),new Error("Engine was broken");n.animation=o,n.id=Number(r.id)}catch(e){if(!(e instanceof Error&&"AbortError"===e.name))throw e;this.asyncApi.aborted=this.asyncApi.aborted.filter((e=>e.carId!==Number(r.id)))}return n}async resetCar(e){const t=e.parentElement;if(e.classList.add("track__restart_disabled"),this.areAllRestartButtonsOff()){const e=document.querySelector(".control-panel-functional__reset");e&&e.classList.add("control-panel-functional__reset_disabled")}if(!t)return;const n=t.parentElement;if(!n)return;const a=t.querySelector(".track__car-img");if(!(a instanceof SVGSVGElement))return;const s=this.asyncApi.aborted.map((e=>e.carId)).indexOf(Number(n.id)),r=this.asyncApi.aborted[s];if(r&&r.controller.abort(),await this.asyncApi.stopEngine(n.id)){a.classList.add("stop-car"),a.classList.remove("car-finished"),a.classList.remove("car-drive"),a.classList.remove("track__car-img_fire"),a.classList.remove("stop-car");const e=t.querySelector(".track__start");if(e&&e.classList.remove("track__start_disabled"),this.areAllStartButtonsOn()){const e=document.querySelector(".control-panel-functional__race");e&&e.classList.remove("control-panel-functional__race_disabled"),this.paginationButtonsStateChanger(!0);const t=this.garagePage.querySelectorAll(".car-controls__select"),n=this.garagePage.querySelectorAll(".car-controls__remove");t.forEach((e=>{e.classList.remove("car-controls__select_disabled")})),n.forEach((e=>{e.classList.remove("car-controls__remove_disabled")})),this.unblockButtons()}}}blockButtons(){const e=document.querySelector(".control-panel-functional__generate");e&&e.classList.add("control-panel-functional__generate_disabled");const t=this.controlPanel.querySelector(".control-panel-create__name"),n=this.controlPanel.querySelector(".control-panel-create__color"),a=this.controlPanel.querySelector(".control-panel-create__crt"),s=this.controlPanel.querySelector(".control-panel-update__name"),r=this.controlPanel.querySelector(".control-panel-update__color"),i=this.controlPanel.querySelector(".control-panel-update__upt");this.selectedCar=0,t instanceof HTMLInputElement&&n instanceof HTMLInputElement&&a instanceof HTMLButtonElement&&s instanceof HTMLInputElement&&r instanceof HTMLInputElement&&i instanceof HTMLButtonElement&&(t.value="",s.value="",n.value="#ffffff",r.value="#ffffff",t.classList.add("control-panel-create__name_disabled"),n.classList.add("control-panel-create__color_disabled"),a.classList.add("control-panel-create__crt_disabled"),s.classList.add("control-panel-update__name_disabled"),r.classList.add("control-panel-update__color_disabled"),i.classList.add("control-panel-update__upt_disabled"))}unblockButtons(){const e=document.querySelector(".control-panel-functional__generate");e&&e.classList.remove("control-panel-functional__generate_disabled");const t=this.controlPanel.querySelector(".control-panel-create__name"),n=this.controlPanel.querySelector(".control-panel-create__color"),a=this.controlPanel.querySelector(".control-panel-create__crt");t instanceof HTMLInputElement&&n instanceof HTMLInputElement&&a instanceof HTMLButtonElement&&(t.classList.remove("control-panel-create__name_disabled"),n.classList.remove("control-panel-create__color_disabled"),a.classList.remove("control-panel-create__crt_disabled"))}async race(){const e=this.garagePage.querySelectorAll(".track__start"),t=[];e.forEach((e=>{t.push(this.driveCar(e,!0))}));try{const e=await Promise.any(t),n=document.getElementById(String(e.id));if(!n)return;const a=n.querySelector(".car-controls__name");if(!a)return;const s=a.textContent;null!==s&&this.showModalWinner(s,e.animation,!1),this.winner={id:e.id,wins:1,time:Math.trunc(e.animation/10)/100},document.body.dispatchEvent(new Event("createWinner"))}catch(e){e instanceof Error&&"AggregateError"===e.name?this.showModalWinner("",-1,!0):console.error(e)}const n=document.querySelector(".control-panel-functional__reset");n&&n.classList.remove("control-panel-functional__reset_disabled")}showModalWinner(e,t,n){this.winnerMgs.textContent=n?"All the cars are broken":`${e} won (${Math.trunc(t/10)/100}s)`,this.winnerMgs.classList.add("winner-msg_show")}reset(){Array.from(this.garagePage.querySelectorAll(".track__restart")).forEach((e=>{e.dispatchEvent(new Event("click",{bubbles:!0}))})),this.winnerMgs.classList.remove("winner-msg_show")}async updateGaragePage(){const{total:e,cars:t}=await this.asyncApi.getCars(this.currentPage,7),n=this.garage.querySelector(".garage__title");n&&(n.textContent=`Garage (${e})`);const s=this.garage.querySelector(".garage-page__title");s&&(s.textContent=`Page #${this.currentPage}`);const r=this.garage.clientHeight;this.garage.style.height=`${r}px`;const i=this.garage.querySelector(".garage-page__cars");if(!(i instanceof HTMLDivElement))return;i.replaceChildren();let c=0;t.forEach((async e=>{a.addCar(e,i),c+=1,c===t.length&&(this.garage.style.height="auto")}))}static toGarage(){const e=document.querySelector(".winners-screen");e&&(document.body.classList.remove("body_overflow"),e.classList.remove("winners-screen_show"))}static toWinners(){const e=document.querySelector(".winners-screen");e&&(document.body.classList.add("body_overflow"),e.classList.add("winners-screen_show"))}}const s=a;var r;!function(e){e.ID="id",e.WINS="wins",e.TIME="time"}(r||(r={}));class i{winnersScreen;header;main;nav;winnersPages;winnersBlock;asyncApi;currentPage;numberSort;winsSort;timeSort;sortObj;constructor(){this.winnersScreen=document.createElement("div"),this.header=document.createElement("header"),this.main=document.createElement("main"),this.nav=document.createElement("nav"),this.winnersPages=document.createElement("div"),this.winnersBlock=document.createElement("div"),this.numberSort=document.createElement("li"),this.winsSort=document.createElement("li"),this.timeSort=document.createElement("li"),this.asyncApi=new t,this.currentPage=1,this.sortObj={type:"id",order:"ASC"}}create(){this.winnersScreen.classList.add("winners-screen"),this.header.classList.add("header"),this.main.classList.add("main"),this.nav.classList.add("nav"),this.winnersPages.classList.add("winners"),this.winnersBlock.classList.add("winners-page__winners-block"),this.numberSort.classList.add("winners-page-header__item"),this.winsSort.classList.add("winners-page-header__item"),this.timeSort.classList.add("winners-page-header__item");const t=new e("nav__garage").createButton("To Garage"),n=new e("nav__winners").createButton("To Winners");return t.addEventListener("click",(()=>this.toGarage())),n.addEventListener("click",(()=>this.toWinners())),this.feedWinners(),this.nav.append(t,n),this.header.append(this.nav),this.main.append(this.winnersPages),this.winnersScreen.append(this.header,this.main),this.UpdateWinnersPage(this.sortObj.type,this.sortObj.order),this.winnersScreen}feedWinners(){const t=document.createElement("h2");t.classList.add("winners__title");const n=document.createElement("div");n.classList.add("winners-controls");const a=new e("winners-controls__prev").createButton("<-"),s=new e("winners-controls__next").createButton("->");a.addEventListener("click",(()=>this.movePage(!1))),s.addEventListener("click",(()=>this.movePage(!0))),n.append(a,s),this.winnersPages.append(t,n),this.addPage()}addPage(){const e=document.createElement("div");e.classList.add("winners-page");const t=document.createElement("h3");t.classList.add("winners-page__title"),t.append("Page #1");const n=document.createElement("ul");n.classList.add("winners-page-header"),["Number","Car","Name","Wins","Best time (seconds)"].forEach((e=>{if("Number"===e)this.numberSort.append(e),this.numberSort.addEventListener("click",(()=>this.sortBy(this.numberSort,this.winsSort,this.timeSort))),n.append(this.numberSort);else if("Wins"===e)this.winsSort.append(e),this.winsSort.addEventListener("click",(()=>this.sortBy(this.winsSort,this.numberSort,this.timeSort))),n.append(this.winsSort);else if("Best time (seconds)"===e)this.timeSort.append(e),this.timeSort.addEventListener("click",(()=>this.sortBy(this.timeSort,this.numberSort,this.winsSort))),n.append(this.timeSort);else{const t=document.createElement("li");t.classList.add("winners-page-header__item"),t.append(e),n.append(t)}})),e.append(t,n,this.winnersBlock),this.winnersPages.append(e)}sortBy(e,t,n){t.classList.remove("winners-page-header__item_asc"),t.classList.remove("winners-page-header__item_desc"),n.classList.remove("winners-page-header__item_asc"),n.classList.remove("winners-page-header__item_desc");let a="";switch(e.textContent){case"Number":a=r.ID;break;case"Wins":a=r.WINS;break;case"Best time (seconds)":a=r.TIME}this.sortObj.type=a,e.classList.contains("winners-page-header__item_asc")?(e.classList.remove("winners-page-header__item_asc"),e.classList.add("winners-page-header__item_desc"),this.sortObj.order="DESC",this.UpdateWinnersPage(a,"DESC")):(e.classList.remove("winners-page-header__item_desc"),e.classList.add("winners-page-header__item_asc"),this.sortObj.order="ASC",this.UpdateWinnersPage(a,"ASC"))}addWinner(e,t,n,a,s){const r=document.createElement("p");r.classList.add("winner");const c=document.createElement("span");c.classList.add("winner__id"),c.append(`${e}`);const o=document.createElement("span");o.classList.add("winner__name"),o.append(a);const l=document.createElement("span");l.classList.add("winner__wins"),l.append(`${t}`);const d=document.createElement("span");d.classList.add("winner__best-time"),d.append(`${n}`),r.append(c),r.append(i.setCarImg(s)),r.append(o),r.append(l),r.append(d),this.winnersBlock.append(r)}static setCarImg(e){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");return t.classList.add("winner__car-img"),t.setAttributeNS(null,"viewBox","0 0 1280 640"),t.setAttributeNS(null,"width","1706.667"),t.setAttributeNS(null,"height","853.333"),t.setAttributeNS(null,"fill",e),["M356.5 106.4c-10.6 3-10.1 2.6-10.8 11.1-.4 4.2-.9 8-1.2 8.5-.6 1-24.6 10.5-59 23.4-44.8 16.7-105.2 41.5-117.3 48.3-7.8 4.3-19.3 9.1-25 10.4-2.3.5-9.8 1.4-16.5 1.9-6.7.6-16.7 1.9-22.2 3-15.4 3.1-34 4.9-56.3 5.7l-20.3.6-4.3 6.6c-5.9 9.1-6 9.5-2.6 13 3.7 3.7 3.8 6.5.3 15-2.5 6.2-2.7 7.8-3.1 25.6l-.4 19-3.8 3.2C4.9 309.5.7 322.6.6 343.5c0 19.4 1.1 39.6 2.6 48.2 1.3 7.1 1.4 7.4 7.2 12.2 6.9 5.8 13 12.9 15.8 18.4 6.4 12.6 53.4 21.1 138.4 25l9.2.4-.6-11.9c-.6-14.2.8-25.6 4.9-38.3 11.2-35.2 39.4-62.2 75.6-72.2 9-2.6 11.2-2.8 27.8-2.8 16.5 0 18.8.2 27.8 2.7 20.1 5.6 36.1 15.2 50.4 30.2 14 14.5 22.2 29.3 27.4 49.2 2.1 7.9 2.4 10.9 2.3 27.9-.1 12.7-.6 21.4-1.6 26.3l-1.5 7.3 300.6-.7c165.3-.4 300.7-.8 300.9-.9.1-.1-.8-3.7-2-8.1-1.9-6.7-2.2-10.5-2.2-25.9-.1-16.6.1-18.7 2.7-27.9 11.7-42.1 46.7-73.6 88.5-79.7 11.9-1.7 32.5-.7 43.2 2.1 23.9 6.3 45.3 20.5 60.1 39.9 7 9.2 15.4 26.7 18.5 38.6 2.4 8.8 2.7 11.9 2.7 26 .1 11.6-.4 18.1-1.6 23.4-1 4.1-1.6 7.5-1.5 7.6.2.1 6.2-.2 13.3-.6 26.6-1.6 45.8-4.5 52.5-7.9 4.8-2.4 9.7-8.1 12.7-14.6l2.4-5.2-1.6-15.7c-1.5-15.2-1.5-16.3.4-28.4 6.3-38.8 5-68-3.5-80.2-13.4-19.3-52.6-33.6-142.9-51.9-73.7-14.9-132.2-20.9-203.3-21-22.8 0-22.6 0-34.7-8.5-18.7-13.1-104.5-60.7-147.1-81.5-38.3-18.7-78.8-28.1-143.9-33.2-20.8-1.7-110.6-1.6-140 0-12.1.7-31.4 1.9-43 2.7-30.2 2.2-28.6 2.2-34.1-1-14-8.1-18.7-9.4-26.9-7.1zM545 139.7c.6 3.7 3.8 23.8 7.1 44.6 3.2 20.9 6.6 42.2 7.5 47.4.9 5.2 1.5 9.6 1.3 9.7-1.1.9-169.9-2.9-195.1-4.4-20.6-1.3-41.7-3.6-48.5-5.4-9.8-2.6-19.8-11.9-24.9-23.1-3.5-7.5-3.6-17.2-.5-25.5 1.7-4.5 3-6.1 6.8-8.6 8.3-5.4 13.5-8 25.3-12.7 34.1-13.6 85.8-23 146-26.7 26.9-1.6 27-1.6 51.1-1.8l22.7-.2 1.2 6.7zm63-4.7c26.4 1.8 77.7 11 102.9 18.6 18.6 5.6 44.5 18.8 75.6 38.7 21.1 13.4 27.4 18.1 25 18.5-7.5 1.2-13.3 5-16.2 10.6-1.9 3.5-2.1 13.6-.4 17.9l1.1 2.7-90.7-.2-90.6-.3-5.9-16c-11-30.2-29.8-87.8-29.8-91.6 0-.6 9.5-.2 29 1.1z","M263.3 327.5c-22.3 4-41 14.1-56.8 30.6-13.2 13.8-21.3 28.3-26.2 46.7-2.2 8.3-2.6 11.9-2.6 24.7-.1 16.9 1 23.6 6.5 38.2 8.7 23 27.1 43.6 49.3 55.1 8.5 4.4 17.8 7.8 27.1 9.8 10.7 2.3 31.2 2.3 41.9-.1 39.2-8.4 69.9-37.5 80.2-76.1 2.3-8.6 2.6-12 2.7-25.4.1-15.8-.5-19.9-4.6-33-9.8-31-35.5-56.7-66.8-66.9-15-5-35.4-6.4-50.7-3.6zm35 30.1c24.9 5.6 45.7 24.7 54.3 49.9 2.5 7.2 2.8 9.5 2.8 22 .1 15.3-1.5 22.8-7.4 34.5-9.4 18.6-28.3 33.7-48.5 38.6-9.6 2.4-26.8 2.4-36 0-32-8.4-54.4-35.5-56.2-68.1-2-35.9 20.9-67.3 55.8-76.5 9.4-2.4 25.3-2.6 35.2-.4z","M260 370.3c-3.6 1.3-8.5 3.6-10.9 5.1l-4.4 2.8 11.6 11.5c8.1 8.2 12 11.4 13.1 11 1.4-.6 1.6-2.9 1.6-16.7 0-18.6.6-17.8-11-13.7zM292 383.9c0 13.9.2 16.2 1.6 16.8 1.1.4 5-2.8 13-10.8l11.5-11.4-2.8-2.2c-3.4-2.8-13.8-7-19.3-7.9l-4-.7v16.2zM228.2 395.2c-2.8 3.6-9.2 19.1-9.2 22.5 0 1 3.4 1.3 16.5 1.3 15.1 0 16.5-.1 16.5-1.8 0-1.5-20.6-23.2-22.1-23.2-.4 0-1.1.6-1.7 1.2zM322.2 404.9c-6.2 5.9-11.2 11.5-11.2 12.4 0 1.5 1.7 1.7 16.5 1.7 13.1 0 16.5-.3 16.5-1.3 0-4-6.9-20.5-9.5-22.7-.7-.6-4.8 2.7-12.3 9.9zM278.1 406.8c-1.2 2.2 1.1 6.2 3.4 6.2.8 0 2.1-1 2.9-2.2 2-2.8.4-5.8-2.9-5.8-1.3 0-2.9.8-3.4 1.8zM274.9 423.9c-3.2 3.3-3.7 6.7-1.4 11 2.9 5.7 10.4 6.4 15.1 1.4 5.3-5.7.9-15.3-7.1-15.3-2.7 0-4.4.8-6.6 2.9zM257 427.5c-2.6 3.2 1.3 8.1 4.8 5.9 2.4-1.6 2.7-4.5.6-6.1-2.3-1.7-3.9-1.6-5.4.2zM300.6 427.6c-2 1.9-2 3.8-.2 5.4 2.3 1.9 6.1.8 6.4-1.8.7-4.4-3.2-6.7-6.2-3.6zM219 442.5c0 2.9 4.1 14 7.2 19.4l3.1 5.3 11.7-11.7c7.1-7.1 11.6-12.3 11.3-13.1-.4-1.1-4-1.4-16.9-1.4-14.1 0-16.4.2-16.4 1.5zM311 442.8c0 .9 5.1 6.8 11.4 13.1l11.4 11.4 3.1-5.4c3-5.1 7.1-16.5 7.1-19.5 0-1.1-3.1-1.4-16.5-1.4-15.1 0-16.5.1-16.5 1.8zM278 449.9c-.7 1.5-.5 2.4.8 4.1 3.2 4 8.5.4 6.2-4.1-1.4-2.5-5.6-2.5-7 0zM256.2 470.3c-6.1 6.2-11.2 11.5-11.2 11.9 0 1.8 20.8 10.8 24.9 10.8.7 0 1.1-5.4 1.1-16.4 0-14-.2-16.5-1.6-17-.9-.3-1.6-.6-1.7-.6-.1 0-5.3 5.1-11.5 11.3zM293.3 459.7c-1.5.6-1.9 33.3-.4 33.3 4.6 0 25.1-8.8 25.1-10.8 0-.9-22.3-23.2-23-23.1-.3 0-1.1.3-1.7.6zM1070 328.1c-39 8.4-69.6 37.6-79.7 75.9-3.1 11.7-4.1 29.2-2.4 41.1 3.3 22.7 15 45.3 31.8 60.9 26.7 25 64.3 34.4 99.3 24.9 11.7-3.2 28.3-11.8 38-19.6 48.7-39.6 51.8-112.8 6.7-156-9.7-9.3-16.6-14-29-19.8-13.7-6.4-23.5-8.6-40.7-9.1-12-.3-16.2 0-24 1.7zm44.5 31.3c23.8 8.1 40.9 25.8 48.6 50.6 3 9.6 3.3 28.9.5 38.8-11 40-51.3 63.7-91.1 53.6-14.9-3.8-31.3-14.7-40.2-26.7-17.6-23.8-20.3-53.3-7.1-79.7 3.4-6.9 6-10.3 13.8-18 7.7-7.8 11.1-10.4 18.1-13.9 12.9-6.5 20.7-8.1 36.4-7.7 10.9.3 14.3.7 21 3z","M1070.3 370c-5.4 1.9-15.3 7.1-15.3 8 0 .3 5.1 5.7 11.4 11.9 8 8 11.9 11.2 13 10.8 1.4-.5 1.6-2.9 1.6-16.7v-16l-2.7.1c-1.6 0-5.2.9-8 1.9zM1102 383.9c0 13.9.2 16.2 1.6 16.8 2.2.8 24.7-21.6 23.4-23.2-1.7-2-16.3-8.4-20.7-9.1l-4.3-.7v16.2zM1036.6 397.6c-2.9 4.4-7.6 16.5-7.6 19.4 0 1.9.7 2 16.5 2 12.6 0 16.5-.3 16.5-1.3 0-.7-5.1-6.3-11.4-12.6l-11.4-11.4-2.6 3.9zM1131.3 405.2c-6.1 6.2-10.9 11.9-10.6 12.5.6 1.5 33.3 1.9 33.3.4 0-4.5-8.8-24.1-10.8-24.1-.4 0-5.7 5.1-11.9 11.2zM1088.2 406.2c-1.7 1.7-1.5 3.2.7 5.2 1.6 1.4 2.3 1.5 4.1.6 3.1-1.7 2.4-6.4-1-6.8-1.4-.2-3.1.3-3.8 1zM1084.6 424.1c-6.8 8.1 1.7 19.4 11 14.4 8.9-4.8 5.6-17.5-4.6-17.5-3 0-4.4.6-6.4 3.1zM1067 427.4c-1.9 2.3-.8 6.1 1.8 6.4 4.4.7 6.7-3.2 3.6-6.2-1.9-2-3.8-2-5.4-.2zM1110.6 427.3c-2.1 1.6-1.8 4.5.7 6.1 3.7 2.3 7.7-3.5 4.1-6.1-1-.7-2.1-1.3-2.4-1.3-.3 0-1.4.6-2.4 1.3zM1029 443c0 2.9 4.3 14.1 7.4 19.5l2.8 4.8 11.6-11.6c8.1-8.1 11.3-12 10.9-13.1-.6-1.4-2.9-1.6-16.7-1.6-15.2 0-16 .1-16 2zM1120.7 442.2c-.3.7 4.7 6.6 11.1 13l11.6 11.8 2.7-4.3c2.7-4.4 7.9-17.7 7.9-20.3 0-1.2-2.8-1.4-16.4-1.4-12.2 0-16.6.3-16.9 1.2zM1088.1 449.9c-1.4 2.5-.5 4.8 2 5.6 2.7.9 5.1-1.3 4.7-4.4-.4-3.4-5.1-4.3-6.7-1.2zM1066.2 470.3c-6.1 6.2-11.2 11.5-11.2 11.9 0 2 20.1 10.8 24.7 10.8 1 0 1.3-3.4 1.3-16.4 0-14-.2-16.5-1.6-17-.9-.3-1.6-.6-1.7-.6-.1 0-5.3 5.1-11.5 11.3zM1103.3 459.7c-1 .3-1.3 4.7-1.3 16.9 0 9 .4 16.4.8 16.4 3.6 0 18.6-6.1 23.9-9.8 1.6-1-21.6-24.2-23.4-23.5z"].forEach((e=>{const n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttributeNS(null,"d",e),t.append(n)})),t}async UpdateWinnersPage(e,t){const{total:n,winners:a}=await this.asyncApi.getWinners(this.currentPage,10,e,t),s=this.winnersPages.querySelector(".winners__title");s&&(s.textContent=`Winners (${n})`);const r=this.winnersPages.querySelector(".winners-page__title");r&&(r.textContent=`Page #${this.currentPage}`);const i=this.winnersPages.clientHeight;this.winnersPages.style.height=`${i}px`,this.winnersBlock.replaceChildren();let c=0;a.forEach((async e=>{const{name:t,color:n}=await this.asyncApi.getCar(String(e.id));this.addWinner(e.id,e.wins,e.time,t,n),c+=1,c===a.length&&(this.winnersPages.style.height="auto")})),0===a.length&&(this.winnersPages.style.height="auto")}async addWinnerInfo(e){const t=await this.asyncApi.getWinner(String(e.id));0===t.wins?await this.asyncApi.createWinner(e):(e.time<t.time&&(t.time=e.time),t.wins+=1,await this.asyncApi.updateWinner(t)),this.UpdateWinnersPage(this.sortObj.type,this.sortObj.order)}async deleteWinnerInfo(e){0!==(await this.asyncApi.getWinner(String(e.id))).wins&&(await this.asyncApi.deleteWinner(String(e.id)),this.UpdateWinnersPage(this.sortObj.type,this.sortObj.order))}async updateWinnerInfo(){this.UpdateWinnersPage(this.sortObj.type,this.sortObj.order)}async movePage(e){if(this.currentPage=e?this.currentPage+1:this.currentPage-1,this.currentPage<1)return void(this.currentPage=1);const{winners:t}=await this.asyncApi.getWinners(this.currentPage,10,this.sortObj.type,this.sortObj.order);0===t.length?this.currentPage=e?this.currentPage-1:this.currentPage+1:this.UpdateWinnersPage(this.sortObj.type,this.sortObj.order)}toGarage(){document.body.classList.remove("body_overflow"),this.winnersScreen.classList.remove("winners-screen_show")}toWinners(){document.body.classList.add("body_overflow"),this.winnersScreen.classList.add("winners-screen_show")}}const c=i;(new class{body;constructor(){this.body=document.body,this.body.classList.add("body")}start(){const e=new s;this.body.append(e.create());const t=new c;this.body.append(t.create()),this.body.addEventListener("createWinner",(()=>t.addWinnerInfo(e.winner))),this.body.addEventListener("deleteWinner",(()=>t.deleteWinnerInfo(e.winner))),this.body.addEventListener("updateWinner",(()=>t.updateWinnerInfo()))}}).start()})();